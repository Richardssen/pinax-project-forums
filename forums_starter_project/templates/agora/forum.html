{% extends "agora/base.html" %}

{% load humanize %}

{% block body %}
    <div>
        <div class="breadcrumb">
            <a href="{% url agora_forums %}">Forums</a>
            {% if forum.category %}
                {% if forum.category.parent %}
                    <span class="divider">&raquo;</span>
                    <a href="{% url agora_category forum.category.parent.id %}">{{ forum.category.parent.title }}</a>
                {% endif %}
                <span class="divider">&raquo;</span>
                <a href="{% url agora_category forum.category.id %}">{{ forum.category.title }}</a>
            {% else %}
                {% if forum.parent %}
                    {% if forum.parent.category %}
                        {% if forum.parent.category.parent %}
                            <span class="divider">&raquo;</span>
                            <a href="{% url agora_category forum.parent.category.parent.id %}">{{ forum.parent.category.parent.title }}</a>
                        {% endif %}
                        <span class="divider">&raquo;</span>
                        <a href="{% url agora_category forum.parent.category.id %}">{{ forum.parent.category.title }}</a>
                    {% else %}
                        {% if forum.parent.parent %}
                            <span class="divider">&raquo;</span>
                            <a href="{% url agora_forum forum.parent.parent.id %}">{{ forum.parent.parent.title }}</a>
                        {% endif %}
                    {% endif %}
                    <span class="divider">&raquo;</span>
                    <a href="{% url agora_forum forum.parent.id %}">{{ forum.parent.title }}</a>
                {% endif %}
            {% endif %}
            <span class="divider">&raquo;</span>
        </div>
        {% if user.is_authenticated %}
            <div style="float: right;">
                <a class="btn" href="{% url agora_new_post forum.id %}">Make a New Post</a>
            </div>
        {% endif %}
        <h2>{{ forum.title }}</h2>
        <p>
            {{ forum.last_modified|date }}
            <str> &bull; </str>
            {{ forum.threads.all.count|intcomma }} Thread{{ forum.threads.all.count|pluralize }}
            <str> &bull; </str>
            {{ forum.reply_count|intcomma }} post{{ forum.reply_count|pluralize }}
        </p>
    </div>
    
    {% if forum.subforums.all %}
        <table class="zebra-striped">
            <thead>
                <tr>
                    <th>Sub-Forum Name</th>
                    <th>Last Post</th>
                    <th>Threads</th>
                    <th>Posts</th>
                </tr>
            </thead>
            <tbody>
                {% for subforum in forum.subforums.all %}
                    <tr>
                        <td><a href="{% url agora_forum subforum.id %}">{{ subforum.title }}</a><br />
                            <small>{{ subforum.description }}</small></td>
                        {% if subforum.last_reply %}
                           <td><a href="{% url agora_thread subforum.last_reply.thread.id %}">{{ subforum.last_reply.thread.title }}</a><br />
                           <small>by <a href="{# url user_page subforum.last_reply.author.id #}">{{ subforum.last_reply.author.username }}</a></small></td>
                        {% else %} 
                            <td></td>
                        {% endif %}
                        <td>{{ subforum.threads.all.count|intcomma }}</td>
                        <td>{{ subforum.reply_count|intcomma }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
    
    <table class="zebra-striped">
        <thead>
            <tr>
                <th>Thread Title</th>
                <th>Last Post</th>
                <th>Replies</th>
                <th>Views</th>
            </tr>
        </thead>
        <tbody>
            {% for thread in threads %}
                <tr>
                    <td><a href="{% url agora_thread thread.id %}">{{ thread.title }}</a><br />
                        <small>by <a href="{# url user_page thread.author.id #}">{{ thread.author.username }}</a> {{ thread.creation_date|timesince}} ago </small></td>
                    <td>{# <a href="{% url agora_thread thread.id %}">{{ thread.title }}</a><br /> #}
                        <small>by <a href="{# url user_page thread.last_reply.author.id #}">{{ thread.last_reply.author.username }}</a> {{ thread.last_reply.created|timesince}} ago</small></td>
                    <td>{{ thread.reply_count|intcomma }}</td>
                    <td>{{ thread.view_count|intcomma }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <div>@@@ pagination</div>
{% endblock %}