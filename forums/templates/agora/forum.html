{% extends "agora/base.html" %}

{% load humanize %}

{% block body %}
    {% include "agora/_forum_breadcrumb.html" %}
    
    {% if can_create_thread %}
        <div style="float: right;">
            <a class="btn" href="{% url agora_post_create forum.id %}">Make a New Post</a>
        </div>
    {% endif %}
    
    <h2>
        {{ forum.title }}
        {% if forum.closed %}<span class="label">closed</span>{% endif %}
    </h2>
    
    <p class="lead">{{ forum.description }}</p>
    
    {% if forum.subforums.all %}
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Sub-Forum Name</th>
                    <th>Last Post</th>
                    <th>Threads</th>
                    <th>Posts</th>
                </tr>
            </thead>
            <tbody>
                {% for subforum in forum.subforums.all %}
                    <tr>
                        <td><a href="{% url agora_forum subforum.id %}">{{ subforum.title }}</a><br />
                            <small>{{ subforum.description }}</small></td>
                        {% if subforum.last_post %}
                           <td><a href="{% url agora_thread subforum.last_post.thread.id %}">{{ subforum.last_post.thread.title }}</a><br />
                           <small>by <a href="{# url user_page subforum.last_post.author.id #}">{{ subforum.last_post.author.username }}</a></small></td>
                        {% else %} 
                            <td></td>
                        {% endif %}
                        <td>{{ subforum.threads.all.count|intcomma }}</td>
                        <td>{{ subforum.post_count|intcomma }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
    
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Thread Title</th>
                <th>Last Post</th>
                <th>Replies</th>
                <th>Views</th>
            </tr>
        </thead>
        <tbody>
            {% for thread in threads %}
                <tr>
                    <td>
                        <a href="{% url agora_thread thread.id %}"><b>{{ thread.title }}</b></a>
                        {% if thread.sticky %}<span class="label notice">sticky</span>{% endif %}
                        {% if thread.closed %}<span class="label">closed</span>{% endif %}
                        <br />
                        <small>by <a href="{# url user_page thread.author.id #}">{{ thread.author.username }}</a> {{ thread.created|timesince}} ago </small></td>
                    <td>{# <a href="{% url agora_thread thread.id %}">{{ thread.title }}</a><br /> #}
                        <small>by <a href="{# url user_page thread.last_post.author.id #}">{{ thread.last_post.author.username }}</a> {{ thread.last_post.created|timesince}} ago</small></td>
                    <td>{{ thread.reply_count|intcomma }}</td>
                    <td>{{ thread.view_count|intcomma }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    
    {% include "pagination/pagination.html" %}
{% endblock %}